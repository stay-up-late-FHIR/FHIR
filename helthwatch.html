<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Watch Simulator</title>
    <style>
        body {
            background-color: #444; /* èª¿äº®èƒŒæ™¯é¿å…æ•´ç‰‡å…¨é»‘ */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        .container { border: 2px solid #666; /* åŠ é‚Šæ¡†æ–¹ä¾¿ç¢ºèªæ˜¯å¦é¡¯ç¤º */
            display: flex;
            flex-direction: row;
            gap: 30px;
        }
        .side-box {
            width: 200px;
            height: 380px;
            background: #333;
            border-radius: 20px;
            padding: 20px;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 0 10px rgba(0,0,0,0.6);
        }
        .side-title {
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .btn-side {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: none;
            border-radius: 10px;
            background-color: #ff9f0a;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-side-danger {
            background-color: #ff453a;
            color: white;
        }

        .watch-face {
            width: 300px;
            height: 380px;
            background-color: black;
            border-radius: 40px;
            border: 4px solid #444;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            padding: 20px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .header { font-size: 14px; color: #aaa; margin-bottom: 20px; width: 100%; text-align: center;}        
        .metric-label { font-size: 14px; margin-top: 5px; color: #ccc; }
        .metric-value { font-size: 36px; font-weight: bold; margin-bottom: 10px; }
        .status { margin-top: 15px; font-size: 12px; color: #888; text-align: center; height: 40px;}

        .alert-box {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(50,0,0,0.9);
            border-radius: 36px;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            z-index: 10;
        }
    .shake {
    animation: shakeAnim 0.6s ease;
}
@keyframes shakeAnim {
    0% { transform: translateX(0); }
    25% { transform: translateX(-10px); }
    50% { transform: translateX(10px); }
    75% { transform: translateX(-10px); }
    100% { transform: translateX(0); }
}
</style>
</head>
<body>
    <div class="container">
        <div class="side-box">
            <div class="side-title">æ¨¡æ“¬é é˜²æƒ…å¢ƒ</div>
            <!-- æ­£ç¢ºçš„ onclickï¼šåªå‘¼å«å·²å®šç¾©çš„å‡½å¼ -->
            <button class="btn-side" onclick="simulatePrevention();">âš ï¸ é é˜²è­¦å ±</button>
        </div>

        <div class="watch-face" onclick="watchTapped();">
            <div class="header">10:09</div>

            <div class="metric-label">â¤ï¸ å¿ƒç‡ HR</div>
            <div class="metric-value" id="hrDisplay">72</div>

            <div class="metric-label">ğŸ“‰ å¿ƒç‡è®Šç•° HRV</div>
            <div class="metric-value" id="hrvDisplay">55</div>

            <div class="metric-label">ğŸ©¸ è¡€æ°§ SpOâ‚‚</div>
            <div class="metric-value" id="spoDisplay">98%</div>

            <div class="status" id="statusLog">ç³»çµ±å¾…å‘½ä¸­...</div>

            <div class="alert-box" id="alertBox">
                <h2 style="color: #ff453a;">è­¦å ±</h2>
                <p id="alertMsg">æ­£åœ¨è¯çµ¡æ€¥è¨º...</p>
                <button class="btn-side" id="closeBtn" onclick="closeAlert();">é—œé–‰</button>
            </div>
        </div>

        <div class="side-box">
            <div class="side-title">æ¨¡æ“¬æ€¥æ•‘æƒ…å¢ƒ</div>
            <button class="btn-side btn-side-danger" onclick="simulateEmergency();">ğŸš‘ è·Œå€’æ˜è¿·</button>
        </div>
    </div>

    <script>
        /* === æ‰‹éŒ¶æ™ƒå‹•æ•ˆæœï¼ˆå–ä»£éœ‡å‹•ï¼‰=== */
        function vibrateWatch() {
            const watch = document.querySelector('.watch-face');
            watch.classList.add('shake');
            setTimeout(()=> watch.classList.remove('shake'), 600);
        }

        /* === æ€¥æ•‘èªéŸ³å¾ªç’°æ’­å ± === */
        let emergencySpeech;
        let speaking = false;

        function startEmergencyBroadcast() {
            if (!('speechSynthesis' in window)) return; // è‹¥ä¸æ”¯æ´å‰‡ç›´æ¥è¿”å›
            if (!speaking) {
                speaking = true;
                emergencySpeech = new SpeechSynthesisUtterance('è«‹æŒ‰ä¸‹æ‰‹éŒ¶ç•«é¢å¹«åŠ©é€™ä½æ‚£è€…');
                emergencySpeech.lang = 'zh-TW';
                emergencySpeech.rate = 1.0;
                emergencySpeech.onend = () => {
                    if (speaking) {
                        // é‡æ–°å»ºç«‹æ–°çš„ utteranceï¼Œé¿å…æŸäº›ç€è¦½å™¨ç„¡é™å¾ªç’°å•é¡Œ
                        const next = new SpeechSynthesisUtterance('è«‹æŒ‰ä¸‹æ‰‹éŒ¶ç•«é¢å¹«åŠ©é€™ä½æ‚£è€…');
                        next.lang = 'zh-TW';
                        next.rate = 1.0;
                        next.onend = () => { if (speaking) speechSynthesis.speak(next); };
                        speechSynthesis.speak(next);
                    }
                };
                speechSynthesis.speak(emergencySpeech);
            }
        }

        function stopEmergencyBroadcast() {
            speaking = false;
            if ('speechSynthesis' in window) speechSynthesis.cancel();
        }

        /* === é»æ“Šæ‰‹éŒ¶ç•«é¢é¡¯ç¤ºæŒ‡ç¤ºè¨Šæ¯ === */
        function watchTapped() {
            // ç•¶æ­£åœ¨æ’­å ±æ™‚ï¼Œé»æ“Šæœƒåœæ­¢æ’­å ±ä¸¦é¡¯ç¤ºæŒ‡ç¤ºèˆ‡é—œé–‰éµ
            if (speaking) {
                stopEmergencyBroadcast();
                showAlert('ğŸ“¢ æ’­å ±æŒ‡ç¤ºè¨Šæ¯ä¸­...<br>ğŸ‘¨â€âš•ï¸ é†«ç”ŸèªéŸ³é€šè©±å·²é€£ç·š', true);
                log('æ’­å ±æŒ‡ç¤ºè¨Šæ¯ / é†«ç”Ÿé€šè©±é€£ç·š');
            }
        }

        function log(msg) {
            document.getElementById('statusLog').innerText = msg;
        }

        function showAlert(msg, showClose = false) {
            document.getElementById('alertMsg').innerHTML = msg;
            const alertBox = document.getElementById('alertBox');
            alertBox.style.display = 'flex';
            const closeBtn = document.getElementById('closeBtn');
            closeBtn.style.display = showClose ? 'block' : 'none';
        }

        function closeAlert() {
            document.getElementById('alertBox').style.display = 'none';
            // å›åˆ°åˆå§‹ç•«é¢
            document.getElementById('hrDisplay').innerText = "72";
            document.getElementById('hrvDisplay').innerText = "55";
            document.getElementById('spoDisplay').innerText = "98%";
            document.getElementById('statusLog').innerText = "ç³»çµ±å¾…å‘½ä¸­...";
            stopEmergencyBroadcast();
        }

        const FHIR_SERVER_URL = "https://hapi.fhir.org/baseR4";

        function simulatePrevention() {
            document.getElementById('hrDisplay').innerText = "110";
            document.getElementById('hrvDisplay').innerText = "20";
            document.getElementById('spoDisplay').innerText = "93%";
            log("æ­£åœ¨ä¸Šå‚³ AI é¢¨éšªè©•ä¼°...");

            // é¡¯ç¤ºè­¦å ±ä¸¦ç«‹åˆ»é¡¯ç¤ºé—œé–‰éµ
            showAlert("âš ï¸ å£“åŠ›éé«˜<br>å»ºè­°ç«‹å³ä¼‘æ¯", true);
            vibrateWatch();
            log("Server å›æ‡‰: 200 OK (Flag Created)");
        }

        function simulateEmergency() {
            document.getElementById('hrDisplay').innerText = "--";
            document.getElementById('hrvDisplay').innerText = "--";
            document.getElementById('spoDisplay').innerText = "--";
            log("åµæ¸¬åˆ°è·Œå€’ï¼ä¸Šå‚³ GPS ä¸­...");

            // é–‹å§‹èªéŸ³å¾ªç’°æ’­å ±ï¼Œä¸é¡¯ç¤ºé—œé–‰éµ
            startEmergencyBroadcast();
            showAlert("ğŸš‘ æ•‘è­·è»Šå·²æ´¾é£<br>é†«ç”Ÿé€£ç·šä¸­...", false);
            log("æ”¶åˆ° ServiceRequest: voice-call=true");
        }
    </script>
</body>
</html>

